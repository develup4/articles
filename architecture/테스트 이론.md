# 테스트 코드의 유지 보수성을 위한 원칙

- 테스트는 빨라야 한다.
- 테스트는 응집력있고 독립적이며 격리되어야 한다.
- 테스트는 존재 이유가 있어야 한다.
- 테스트는 반복 가능해야하며 불안정하지 않아야 한다.
- 테스트의 단언문은 탄탄해야 한다.
- 테스트는 행위가 변경될 경우 깨져야 한다.
- **테스트는 단 하나의 명확한 이유로 실패해야 한다.**
- 테스트는 작성하기 쉬워야 한다.
- 테스트는 읽기 쉬워야 한다.
- 테스트는 쉽게 수정하고 진화할 수 있어야 한다.

# 용어 정리

## 테스트 더블

- 원래 `스턴트맨`이라는 말은 콩글리시이다. 원래의 영어는 `스턴트더블`로, 더블이라는 단어를 이해하면 좋을 것이다.

### 더미 객체

- `더미`는 테스트 대상 클래스에 전달되지만 절대 사용되지 않는 객체이다.

### 페이크 객체

- `페이크 객체`는 시뮬레이션하려는 클래스같이 실제로 동작하는 구현체를 가진다. 하디만 훨씬 단순한 방법으로 동작한다.

### 스텁

- `스텁`은 테스트 과정에서 수행된 호출에 대해 **하드코딩된 응답**을 제공한다. 스텁은 가장 인기있는 시뮬레이션 유형이다.

### 모의 객체

- `모의 객체(Mock)`는 메서드의 응답을 설정할 수 있다는 점에서 스텁같은 역할을 한다. 하지만 모의 객체는 모든 상호작용을 저장해서 나중에 단언문(Assert)에 활용할 수 있도록 해준다. 예를 들어 호출횟수 등을 기억할 수 있다.

### 스파이

- `스파이`는 실제 객체를 감싸서 그 행동을 모의객체처럼 관찰한다. 다만 스파이는 현업에서는 보기 어렵다.

# 단위 테스트 기초

## 단위 테스트 하네스

- 테스트 케이스를 표현하기 위한 공통 언어
- 일부나 전체 테스트 사례를 구동하기 위한 메커니즘
- 테스트 슈트의 성공이나 실패를 자세히 보고하지만 로그는 남기지 않는다.
- TOF(True or False)

## 테스트 픽스쳐

- 테스트 대상 코드를 수행하는 일련의 테스트 케이스를 위한 적절한 환경을 제공하는 코드
- 양상 코드를 수행하기 위한 일반적인 설정과 환경을 수립하기 위해 도움을 준다.

## 테스트와 해당 테스트의 SUT 범위

- `SUT`: 테스트 대상 시스템(System Under Test)으로 테스트하려는 대상 모두를 의미
- `DOC`: 의존 컴포넌트로 SUT에서 호출하거나 SUT를 실행하는데 필요한 데이터를 미리 설정하는 컴포넌트이다.
- SUT와 DOC 모두 테스트 픽스쳐의 일부이다.

## 단위 테스트

- 결함 국소화를 위해 하나의 시나리오 안에서 하나의 메소드나 객체만 실행하는 단일 조건 테스트로 만들어야 한다.
- 단위 테스트는 크기가 작으므로 테스트 실패를 보면 문제를 금방 확인할 수 있다. 고객 테스트(E2E)에 비해 우월한 이유가 여기에 있다.
- 특성 테스트(비기능적 테스트)는 단위테스트가 아니다.

### 테스트 자동화의 철학

- `상태주의자`: SUT를 특정 상태에 두고 실행한 후 SUT가 원하는 상태인지 검증한다.
- `동작주의자`: SUT의 시작과 끝 상태 뿐만 아니라 SUT가호출하는 것까지 검증한다.

### 테스트 자동화의 원칙

- 절대 SUT를 고쳐서는 안된다. 테스트 코드가 사용 코드와 달라지기 때문이다.
- 테스트를 독립적으로 유지해서 순서에 영향을 받지 않도록 해야한다. 자동화 과정에서 순서를 고려하면 어려워지기 때문이다. 신선한 픽스쳐(teardown)를 사용해서 독립적인 테스트를 유지하자.
- 테스트 로직을 상용 코드에 넣어서는 안된다. if testing then...
- 실행에 0.1초가 걸리는 테스트는 매우 느린 단위 테스트이다. 클래스가 3000개가 있고 각각 10개의 단위테스트가 있다면 3000초가 걸리며 약 한시간이 걸린다. 네트워크 연동, 데이터베이스 연동, 파일 시스템 접근 등 DOC를 격리하지 못하여 시간이 오래걸리는건 아닌지 의심해봐야 한다.

# TDD 기초

## TDD

- Test the program before you write it - Kent Beck
- XP(eXtream Programming)의 실천 방식 중 하나이다.
- 개발자가 `자신`을 위해 처음으로 수행하는 테스트이다.

## Kent Beck의 5단계

- 작은 테스트를 추가한다.
- 모든 테스트를 돌리고, 새로운 실패를 보거나 컴파일 오류를 본다.
- 테스트를 통과하기 위해 필요한 가장 작은 변경을 만든다.
- 모든 테스트를 돌려서 새로운 테스트가 통과하는지 본다.
- 중복을 제거하고 표현력을 높이기 위해 리팩토링을 수행한다.

# 지능형 테스트

- 컴퓨터로 하여금 소프트웨어 시스템을 탐색하도록 하는 모든 것이다.
- 지금까지 우수한 테스트를 생각해내는 것은 인간의 활동이었다. 지능형 테스트 시스템은 테스트 케이스를 우리에게 제안한다.
- 학계에서도 이 개념을 더 이상 새롭거나 이상하게 받아들이지 않는다. 다양한 지능형 테스트 기법이 존재하며, 몇몇 기법은 제품으로 출시될 만큼 충분히 무르익었다.
  - 예를 들어 퍼지 테스트는 예상치 못한 입력을 전달하여 프로그램이 깨지는지 확인한다.
  - 대단한 점은 이런 도구들이 입력값을 무작위로 생성하는게 아니라는 것이다. 점점 더 똑똑해지고 있다.

# 테스트 주도 개발 책 요약

- 데밍은 품질에 대한 책임을 그 누구보다도 작업자에게 맡겨야 한다고 주장했습니다. 우선, 그것이 인간적이며 정중한 정책이기 때문이며, 두 번째로 작업자가 정보를 제일 많이 알고 있고, 또 최종 결과에 직접적 영향을 가장 많이 끼칠 수 있기 때문입니다.
- 작동하는 깔끔한 코드. 문제의 핵심을 찌르는이 한마디가 바로 테스트 주도 개발해 궁극적인 목표다.

1. 빨강 - 실패하는 작은 테스트를 작성한다. 처음에는 컴파일조차 되지 않을 수 있다.
2. 초록 - 빨리 테스트가 통과하게끔 만든다. 이를 위해 어떤 죄악을 저질러도 좋다.
3. 리팩토링 - 일단 테스트를 통가하게만 하는 와중에 생년은 모든 중복을 제거한다. 빨강 슬러시 초록 슬러시 팩토리는 DDDD 의 주문과도 같은 것이다.

- 테스트 주도 개발의 리듬
  - 재빨리 테스트를 하나 추가한다.
  - 모든 테스트를 실행하고 새로 추가하는 것이 실패하는지 확인한다.
  - 코드를 조금 바꾼다.
  - 모든 테스트를 실행하고 전부 성공하는지 확인한다.
  - 리팩토링을 통해 중복을 제거한다.
- 아마 당신은 다음날 같은 것에 놀랄 것이다.
  - 각각의 테스트가 기능의 작은 증가분을 어떻게 커버하는지.
  - 새 테스트를 돌아가기 위해 얼마나 작고 못생긴 변화가 가능한지.
  - 얼마나 자주 테스트를 실행하는지.
  - 얼마나 수없이 작은 단계를 통해 리팩토링이 되어 가는 지.
- 사실은 상향식, 하향식, 이와 같은 수직적 메타포는 프로그램 이 시간에 따라 어떻게 변해가는지에 대한 단순화된 시각일 뿐이다. 이보다 성장이란 단어를 보자. 만약 메타포가 어떤 방향성을 가질 필요가 있다면 상향 혹은 하향보다는 아는 것에서 모르는 것으로라는 방향이 유용할 것이다.
- 지치고 고난에 빠졌을 땐 뭘 해야 하나. 그럴 땐 좀 쉬는게 좋다. 데이브 웅가는 이걸 샤워 방법론이라고 부른다. 키보드로 뭘 쳐야할지 알면 그걸 치면 된다. 뭘 해야 할지 모르겠으면 샤워하러 가서 뭘 해야 할지 생각날 때까지 계속 샤워를 한다. 그의 방법론에 따르면 많은 팀들이 더 행복해질 것이고 생산성도 향상될 것이며 냄새도 훨씬 덜 날 것이다.
- TDD는 웅가의 샤워 방법론을 정제한 것이다. 키보드로 뭘 쳐야 할지 알면 명백한 구현을 한다. 그래서 잘 모르겠다면 가짜 구현을 한다. 올바른 설계가 명확하지 않다면 삼각 측량 기법을 사용한다. 그래도 모르겠다면 샤워나 하러 가는 거다.
- TDD는 코드에 감정적 애착을 형성하는 해커들에게도 좋다. 젊은 시절 나의 가장 큰 불만은 이런 것이었다. 엄청난 흥미를 가지고 새 프로젝트를 시작해서는 시간이 지남에 따라 서서히 코드가 썩어가는 걸 보게 된다. 1년쯤 지나면 하루라도 빨리 냄새나는 코드를 던져버리고 다음 프로젝트가 시작되기만을 기다리는 것이다. 나의 목적은 처음 반짝이는 눈빛으로 프로젝트를 시작할 때보다 프로젝트를 시작하고 1년이 지난 후에 더 좋은 느낌을 갖게 되는 것인데, TDD가 목적을 달성할 수 있도록 도와준다
- 개인적으로는 리팩토링으로 유명한 마틴 파울러가 IEEE Software에 기고했던 글인 Separating User Interface Code의 내용에 동의한다. 만일 WIMP(Windows, Icon, Mouse, Pointer) GUI로 응용 프로그램을 작성한다면, WIMP에서 어떠한 코드도 복사하지 않고 WIMP 인터페이스 통해 할 수 있는 모든 일에 대해 명령쪽 인터페이스(CLI)로 응용 프로그램을 작성할 수 있어야 한다.
- XP에서 주문처럼 불리는 DTSTTCPW(Do the simplest thing that could possibly work) 즉, 제대로 돌아가는 가장 간단한 것을 하라.
